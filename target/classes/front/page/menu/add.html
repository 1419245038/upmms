<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
    <link rel="stylesheet" href="../../lib/font-awesome-4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="../../layui_ext/dtree/dtree.css">
    <link rel="stylesheet" href="../../layui_ext/dtree/font/dtreefont.css">
    <style>
        body {
            background-color: #ffffff;
        }
    </style>
</head>
<body>
<div class="layui-form layuimini-form">
    <div class="layui-form-item">
        <label class="layui-form-label">父级菜单</label>
        <div class="layui-input-block">
            <input type="hidden" name="pid" id="pid" value="0">
            <ul id="menuSelectTree" class="dtree" data-id="0"></ul>
            <tip>如要添加的菜单为一级菜单，请不要选择此项</tip>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">菜单名称</label>
        <div class="layui-input-block">
            <input type="text" name="title" lay-verify="required" lay-reqtext="菜单名称不能为空" placeholder="请输入菜单名称" value="" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">菜单图标</label>
        <div class="layui-input-block">
            <input type="hidden" name="icon" id="icon" value="fa fa-align-justify">
            <input type="text" name="iconFa" id="iconPicker" lay-filter="iconPicker" value="fa fa-align-justify" autocomplete="off" placeholder="请输入菜单图标" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">菜单url</label>
        <div class="layui-input-block">
            <input type="text" name="href" lay-verify="required" lay-reqtext="菜单url不能为空" placeholder="请输入菜单url" value="" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">排序</label>
        <div class="layui-input-block">
            <input type="number" name="sort" placeholder="请输入排序号" value="" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
        </div>
    </div>
</div>
<script src="../../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script>
    layui.extend({
        dtree:'../../layui_ext/dtree/dtree',
        iconPickerFa :'../../js/lay-module/iconPicker/iconPickerFa'
    }).use(['form','iconPickerFa','dtree'], function () {
        var form = layui.form,
            layer = layui.layer,
            $ = layui.$;
        var dtree = layui.dtree;
        var iconPickerFa = layui.iconPickerFa;

        //监听提交
        form.on('submit(saveBtn)', function (data) {
            $.ajax({
                url:"/sys/menu/add",
                type:"POST",
                data:data.field,
            success:function(data){
                //关闭弹出层
                var iframeIndex = parent.layer.getFrameIndex(window.name);
                parent.layer.close(iframeIndex);
                return false;
            },
            error:function(){
                var index = layer.alert("发生未知错误!", {
                    title: '错误:'
                }, function () {

                    // 关闭弹出层
                    layer.close(index);

                    var iframeIndex = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(iframeIndex);

                });
            }
         });
        });

        //渲染父级菜单下拉树组件
        var menuSelectTree =  dtree.renderSelect({
            elem: "#menuSelectTree",//绑定ul标签的ID属性值
            url: "/sys/menu/parant", //请求地址
            dataStyle: "layuiStyle",  //使用layui风格的数据格式
            dataFormat: "list",  //配置data的风格为list
            response:{message:"msg",statusCode:1},  //修改response中返回数据的定义
        });
        //监听下拉菜单树节点选中事件
        dtree.on("node(menuSelectTree)",function(obj) {
            //给父级菜单的隐藏域赋值
            $("#pid").val(obj.param.nodeId);
        });


        iconPickerFa.render({
            // 选择器，推荐使用input
            elem: '#iconPicker',
            url: '../../lib/font-awesome-4.7.0/less/variables.less',
            // 是否开启搜索：true/false，默认true
            search: true,
            // 是否开启分页：true/false，默认true
            page: true,
            // 每页显示数量，默认12
            limit: 12,
            // 每个图标格子的宽度：'43px'或'20%'
            cellWidth: '43px',
            // 点击回调
            click: function (data) {
                //给图标隐藏域赋值
                $("#icon").val("fa "+data.icon);
            },
            // 渲染成功后的回调
            success: function(d) {
                console.log(d);
            }
        });

    });
</script>
</body>
</html>